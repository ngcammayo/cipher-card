const express = require("express");

const app = express();
const PORT = process.env.PORT || 8000;

const matrices = [
  [],
  [
    120900, 120901, 120964, 121629, 124996, 136525, 167556, 238549, 383044,
    652341,
  ],
  [10920, 10921, 10936, 11001, 11176, 11545, 12216, 13321, 15016, 17481],
  [10920, 10921, 10936, 11001, 11176, 11545, 12216, 13321, 15016, 17481],
  [
    120900, 120901, 120964, 121629, 124996, 136525, 167556, 238549, 383044,
    652341,
  ],
  [10920, 10921, 10936, 11001, 11176, 11545, 12216, 13321, 15016, 17481],
  [10920, 10921, 10936, 11001, 11176, 11545, 12216, 13321, 15016, 17481],
  [
    120900, 120901, 120964, 121629, 124996, 136525, 167556, 238549, 383044,
    652341,
  ],
  [20040, 20041, 20048, 20067, 20104, 20165, 20256, 20383, 20552, 20769],
  [20040, 20041, 20048, 20067, 20104, 20165, 20256, 20383, 20552, 20769],
  [20040, 20041, 20048, 20067, 20104, 20165, 20256, 20383, 20552, 20769],
  [20040, 20041, 20048, 20067, 20104, 20165, 20256, 20383, 20552, 20769],
  [20040, 20041, 20048, 20067, 20104, 20165, 20256, 20383, 20552, 20769],
  [20040, 20041, 20048, 20067, 20104, 20165, 20256, 20383, 20552, 20769],
  [20040, 20041, 20048, 20067, 20104, 20165, 20256, 20383, 20552, 20769],
  [20040, 20041, 20048, 20067, 20104, 20165, 20256, 20383, 20552, 20769],
  [15020, 15021, 15024, 15029, 15036, 15045, 15056, 15069, 15084, 15101],
];

// const cardNumber = 5226040000022007;

app.get("/:cardnumber", (req, res) => {
  if (!req.params.cardnumber)
    return res.status(400).json({ message: "card number is required" });

  if (req.params.cardnumber.length !== 16)
    return res.status(400).json({ message: "invalid card number length" });

  const cardNumber = req.params.cardnumber;

  if (isNaN(cardNumber))
    return res.status(400).json({ message: "card number must be numeric" });

  const cipher = cardNumber
    .toString()
    .split("")
    .map((num, index) => {
      const pos = index + 1;
      return matrices[pos][parseInt(num)];
    })
    .join("");

  return res.json({ cipher });
});

app.listen(PORT, () =>
  console.log(`server started on http://localhost:${PORT}`)
);
